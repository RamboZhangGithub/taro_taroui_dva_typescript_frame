{"version":3,"file":"index.js","sources":["../src/template.ts","../src/components.ts","../src/program.ts","../src/index.ts"],"sourcesContent":["import { RecursiveTemplate, isArray, Shortcuts } from '@tarojs/shared'\n\nconst swanSpecialAttrs = {\n  'scroll-view': ['scrollTop', 'scrollLeft', 'scrollIntoView'],\n  'movable-view': ['x', 'y'],\n  slider: ['value'],\n  input: ['value'],\n  textarea: ['value']\n}\n\nexport class Template extends RecursiveTemplate {\n  supportXS = true\n  Adapter = {\n    if: 's-if',\n    else: 's-else',\n    elseif: 's-elif',\n    for: 's-for',\n    forItem: 's-for-item',\n    forIndex: 's-for-index',\n    key: 's-key',\n    xs: 'sjs',\n    type: 'swan'\n  }\n\n  buildXsTemplate () {\n    return '<import-sjs module=\"xs\" src=\"./utils.sjs\" />'\n  }\n\n  dataKeymap (keymap: string) {\n    return `{ ${keymap} }`\n  }\n\n  getAttrValue (value: string, key: string, nodeName: string) {\n    if (isArray(swanSpecialAttrs[nodeName]) && swanSpecialAttrs[nodeName].includes(key)) {\n      return `= ${value} =`\n    }\n\n    return `{ ${value} }`\n  }\n\n  modifyLoopBody = (child: string, nodeName: string) => {\n    if (nodeName === 'text' || nodeName === 'static-text') {\n      return `<block>{{ i.${Shortcuts.Childnodes}[index].${Shortcuts.Text} }}</block>`\n    }\n\n    return child\n  }\n}\n","import { singleQuote } from '@tarojs/shared'\n\nexport const components = {\n  // ======== 调整属性 ========\n  Progress: {\n    'border-radius': '0',\n    'font-size': '16',\n    duration: '30'\n  },\n  RichText: {\n    selectable: 'false',\n    name: '',\n    attrs: '',\n    children: '[]',\n    text: '',\n    'image-menu-prevent': 'false',\n    preview: ''\n  },\n  Map: {\n    polygons: '[]',\n    'enable-3D': 'false',\n    'show-compass': 'false',\n    'enable-overlooking': 'false',\n    'enable-zoom': 'true',\n    'enable-scroll': 'true',\n    'enable-rotate': 'false',\n    bindRegionChange: '',\n    bindPoiTap: ''\n  },\n  Button: {\n    bindGetPhoneNumber: '',\n    bindGetUserInfo: '',\n    bindOpenSetting: '',\n    bindContact: '',\n    bindChooseAddress: '',\n    bindChooseInvoiceTitle: ''\n  },\n  Form: {\n    'report-type': 'default',\n    'template-id': '',\n    'subscribe-id': ''\n  },\n  Input: {\n    'adjust-position': 'true'\n  },\n  Textarea: {\n    'confirm-type': singleQuote('default'),\n    'confirm-hold': 'false',\n    'show-confirm-bar': 'true',\n    'adjust-position': 'true'\n  },\n  Navigator: {\n    target: singleQuote('self'),\n    'app-id': '',\n    path: '',\n    'extra-data': '',\n    version: singleQuote('version')\n  },\n  Image: {\n    webp: 'false',\n    'image-menu-prevent': 'false',\n    preview: '',\n    'original-src': ''\n  },\n  Video: {\n    title: '',\n    'show-no-wifi-tip': 'true',\n    'vslide-gesture': 'false',\n    'vslide-gesture-in-fullscreen': 'true',\n    'enable-play-gesture': 'false',\n    'show-rate-btn': 'false',\n    'show-vslide-btn-in-fullscreen': 'true',\n    'silent-play': 'false',\n    bindLoadedMetadata: ''\n  },\n  Ad: {\n    appid: '',\n    apid: '',\n    type: singleQuote('feed'),\n    updatetime: '',\n    bindStatus: ''\n  },\n  // ======== 额外组件 ========\n  Tabs: {\n    'tabs-background-color': singleQuote('#fff'),\n    'tabs-active-text-color': singleQuote('#000'),\n    'tabs-inactive-text-color': singleQuote('#666'),\n    'tabs-underline-color': singleQuote('#333'),\n    'active-name': '',\n    'url-query-name': '',\n    'max-tab-item-amount': '5',\n    bindTabChange: ''\n  },\n  TabItem: {\n    label: '',\n    name: '',\n    'badge-type': '',\n    'badge-text': ''\n  },\n  AnimationVideo: {\n    'resource-width': '800',\n    'resource-height': '400',\n    'canvas-style': singleQuote('width:400px;height:400px'),\n    path: '',\n    loop: 'fasle',\n    autoplay: 'fasle',\n    bindStarted: '',\n    bindEnded: ''\n  },\n  AnimationView: {\n    path: '',\n    loop: 'false',\n    autoplay: 'true',\n    action: singleQuote('play'),\n    hidden: 'true',\n    bindEnded: ''\n  },\n  ArCamera: {\n    key: '',\n    type: '',\n    flash: singleQuote('off'),\n    bindError: '',\n    bindLoad: '',\n    bindMessage: '',\n    bindScanCode: ''\n  },\n  RtcRoom: {\n    id: '',\n    'enable-camera': 'true',\n    'enable-auto-focus': 'true',\n    'enable-zoom': 'false',\n    'device-position': singleQuote('front'),\n    'enable-mic': 'true',\n    'enable-agc': 'false',\n    'enable-ans': 'false',\n    bitrate: '900',\n    'video-width': '360',\n    'video-height': '640',\n    'enable-remote-mirror': 'false',\n    'local-mirror': singleQuote('auto'),\n    'sound-mode': singleQuote('speaker'),\n    bindStateChange: '',\n    bindError: ''\n  },\n  RtcRoomItem: {\n    id: '',\n    type: '',\n    'user-id': ''\n  },\n  OpenData: {\n    type: ''\n  }\n}\n","import { TaroPlatformBase } from '@tarojs/service'\nimport { Template } from './template'\nimport { components } from './components'\n\nconst PACKAGE_NAME = '@tarojs/plugin-platform-swan'\nconst PROJECT_JSON = 'project.swan.json'\n\nexport default class Swan extends TaroPlatformBase {\n  platform = 'swan'\n  globalObject = 'swan'\n  runtimePath = `${PACKAGE_NAME}/dist/runtime`\n  taroComponentsPath = `${PACKAGE_NAME}/dist/components-react`\n  fileType = {\n    templ: '.swan',\n    style: '.css',\n    config: '.json',\n    script: '.js',\n    xs: '.sjs'\n  }\n\n  template = new Template()\n\n  /**\n   * 1. setupTransaction - init\n   * 2. setup\n   * 3. setupTransaction - close\n   * 4. buildTransaction - init\n   * 5. build\n   * 6. buildTransaction - close\n   */\n  constructor (ctx, config) {\n    super(ctx, config)\n\n    this.setupTransaction.addWrapper({\n      close () {\n        this.modifyComponents()\n        ctx.generateFrameworkInfo()\n        this.generateProjectConfig(PROJECT_JSON, PROJECT_JSON)\n      }\n    })\n  }\n\n  /**\n   * 增加组件或修改组件属性\n   */\n  modifyComponents () {\n    this.template.mergeComponents(this.ctx, components)\n  }\n}\n","import Swan from './program'\nimport type { IPluginContext } from '@tarojs/service'\n\n// 让其它平台插件可以继承此平台\nexport { Swan }\n\nexport default (ctx: IPluginContext) => {\n  ctx.registerPlatform({\n    name: 'swan',\n    useConfigName: 'mini',\n    async fn ({ config }) {\n      const program = new Swan(ctx, config)\n      await program.start()\n    }\n  })\n}\n"],"names":["RecursiveTemplate","isArray","singleQuote","TaroPlatformBase"],"mappings":";;;;;;;AAEA,MAAM,gBAAgB,GAAG;IACvB,aAAa,EAAE,CAAC,WAAW,EAAE,YAAY,EAAE,gBAAgB,CAAC;IAC5D,cAAc,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC;IAC1B,MAAM,EAAE,CAAC,OAAO,CAAC;IACjB,KAAK,EAAE,CAAC,OAAO,CAAC;IAChB,QAAQ,EAAE,CAAC,OAAO,CAAC;CACpB,CAAA;MAEY,QAAS,SAAQA,wBAAiB;IAA/C;;QACE,cAAS,GAAG,IAAI,CAAA;QAChB,YAAO,GAAG;YACR,EAAE,EAAE,MAAM;YACV,IAAI,EAAE,QAAQ;YACd,MAAM,EAAE,QAAQ;YAChB,GAAG,EAAE,OAAO;YACZ,OAAO,EAAE,YAAY;YACrB,QAAQ,EAAE,aAAa;YACvB,GAAG,EAAE,OAAO;YACZ,EAAE,EAAE,KAAK;YACT,IAAI,EAAE,MAAM;SACb,CAAA;QAkBD,mBAAc,GAAG,CAAC,KAAa,EAAE,QAAgB;YAC/C,IAAI,QAAQ,KAAK,MAAM,IAAI,QAAQ,KAAK,aAAa,EAAE;gBACrD,OAAO,eAAe,gCAA+B,2BAA2B,CAAA;aACjF;YAED,OAAO,KAAK,CAAA;SACb,CAAA;KACF;IAvBC,eAAe;QACb,OAAO,8CAA8C,CAAA;KACtD;IAED,UAAU,CAAE,MAAc;QACxB,OAAO,KAAK,MAAM,IAAI,CAAA;KACvB;IAED,YAAY,CAAE,KAAa,EAAE,GAAW,EAAE,QAAgB;QACxD,IAAIC,cAAO,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;YACnF,OAAO,KAAK,KAAK,IAAI,CAAA;SACtB;QAED,OAAO,KAAK,KAAK,IAAI,CAAA;KACtB;;;ACpCI,MAAM,UAAU,GAAG;;IAExB,QAAQ,EAAE;QACR,eAAe,EAAE,GAAG;QACpB,WAAW,EAAE,IAAI;QACjB,QAAQ,EAAE,IAAI;KACf;IACD,QAAQ,EAAE;QACR,UAAU,EAAE,OAAO;QACnB,IAAI,EAAE,EAAE;QACR,KAAK,EAAE,EAAE;QACT,QAAQ,EAAE,IAAI;QACd,IAAI,EAAE,EAAE;QACR,oBAAoB,EAAE,OAAO;QAC7B,OAAO,EAAE,EAAE;KACZ;IACD,GAAG,EAAE;QACH,QAAQ,EAAE,IAAI;QACd,WAAW,EAAE,OAAO;QACpB,cAAc,EAAE,OAAO;QACvB,oBAAoB,EAAE,OAAO;QAC7B,aAAa,EAAE,MAAM;QACrB,eAAe,EAAE,MAAM;QACvB,eAAe,EAAE,OAAO;QACxB,gBAAgB,EAAE,EAAE;QACpB,UAAU,EAAE,EAAE;KACf;IACD,MAAM,EAAE;QACN,kBAAkB,EAAE,EAAE;QACtB,eAAe,EAAE,EAAE;QACnB,eAAe,EAAE,EAAE;QACnB,WAAW,EAAE,EAAE;QACf,iBAAiB,EAAE,EAAE;QACrB,sBAAsB,EAAE,EAAE;KAC3B;IACD,IAAI,EAAE;QACJ,aAAa,EAAE,SAAS;QACxB,aAAa,EAAE,EAAE;QACjB,cAAc,EAAE,EAAE;KACnB;IACD,KAAK,EAAE;QACL,iBAAiB,EAAE,MAAM;KAC1B;IACD,QAAQ,EAAE;QACR,cAAc,EAAEC,kBAAW,CAAC,SAAS,CAAC;QACtC,cAAc,EAAE,OAAO;QACvB,kBAAkB,EAAE,MAAM;QAC1B,iBAAiB,EAAE,MAAM;KAC1B;IACD,SAAS,EAAE;QACT,MAAM,EAAEA,kBAAW,CAAC,MAAM,CAAC;QAC3B,QAAQ,EAAE,EAAE;QACZ,IAAI,EAAE,EAAE;QACR,YAAY,EAAE,EAAE;QAChB,OAAO,EAAEA,kBAAW,CAAC,SAAS,CAAC;KAChC;IACD,KAAK,EAAE;QACL,IAAI,EAAE,OAAO;QACb,oBAAoB,EAAE,OAAO;QAC7B,OAAO,EAAE,EAAE;QACX,cAAc,EAAE,EAAE;KACnB;IACD,KAAK,EAAE;QACL,KAAK,EAAE,EAAE;QACT,kBAAkB,EAAE,MAAM;QAC1B,gBAAgB,EAAE,OAAO;QACzB,8BAA8B,EAAE,MAAM;QACtC,qBAAqB,EAAE,OAAO;QAC9B,eAAe,EAAE,OAAO;QACxB,+BAA+B,EAAE,MAAM;QACvC,aAAa,EAAE,OAAO;QACtB,kBAAkB,EAAE,EAAE;KACvB;IACD,EAAE,EAAE;QACF,KAAK,EAAE,EAAE;QACT,IAAI,EAAE,EAAE;QACR,IAAI,EAAEA,kBAAW,CAAC,MAAM,CAAC;QACzB,UAAU,EAAE,EAAE;QACd,UAAU,EAAE,EAAE;KACf;;IAED,IAAI,EAAE;QACJ,uBAAuB,EAAEA,kBAAW,CAAC,MAAM,CAAC;QAC5C,wBAAwB,EAAEA,kBAAW,CAAC,MAAM,CAAC;QAC7C,0BAA0B,EAAEA,kBAAW,CAAC,MAAM,CAAC;QAC/C,sBAAsB,EAAEA,kBAAW,CAAC,MAAM,CAAC;QAC3C,aAAa,EAAE,EAAE;QACjB,gBAAgB,EAAE,EAAE;QACpB,qBAAqB,EAAE,GAAG;QAC1B,aAAa,EAAE,EAAE;KAClB;IACD,OAAO,EAAE;QACP,KAAK,EAAE,EAAE;QACT,IAAI,EAAE,EAAE;QACR,YAAY,EAAE,EAAE;QAChB,YAAY,EAAE,EAAE;KACjB;IACD,cAAc,EAAE;QACd,gBAAgB,EAAE,KAAK;QACvB,iBAAiB,EAAE,KAAK;QACxB,cAAc,EAAEA,kBAAW,CAAC,0BAA0B,CAAC;QACvD,IAAI,EAAE,EAAE;QACR,IAAI,EAAE,OAAO;QACb,QAAQ,EAAE,OAAO;QACjB,WAAW,EAAE,EAAE;QACf,SAAS,EAAE,EAAE;KACd;IACD,aAAa,EAAE;QACb,IAAI,EAAE,EAAE;QACR,IAAI,EAAE,OAAO;QACb,QAAQ,EAAE,MAAM;QAChB,MAAM,EAAEA,kBAAW,CAAC,MAAM,CAAC;QAC3B,MAAM,EAAE,MAAM;QACd,SAAS,EAAE,EAAE;KACd;IACD,QAAQ,EAAE;QACR,GAAG,EAAE,EAAE;QACP,IAAI,EAAE,EAAE;QACR,KAAK,EAAEA,kBAAW,CAAC,KAAK,CAAC;QACzB,SAAS,EAAE,EAAE;QACb,QAAQ,EAAE,EAAE;QACZ,WAAW,EAAE,EAAE;QACf,YAAY,EAAE,EAAE;KACjB;IACD,OAAO,EAAE;QACP,EAAE,EAAE,EAAE;QACN,eAAe,EAAE,MAAM;QACvB,mBAAmB,EAAE,MAAM;QAC3B,aAAa,EAAE,OAAO;QACtB,iBAAiB,EAAEA,kBAAW,CAAC,OAAO,CAAC;QACvC,YAAY,EAAE,MAAM;QACpB,YAAY,EAAE,OAAO;QACrB,YAAY,EAAE,OAAO;QACrB,OAAO,EAAE,KAAK;QACd,aAAa,EAAE,KAAK;QACpB,cAAc,EAAE,KAAK;QACrB,sBAAsB,EAAE,OAAO;QAC/B,cAAc,EAAEA,kBAAW,CAAC,MAAM,CAAC;QACnC,YAAY,EAAEA,kBAAW,CAAC,SAAS,CAAC;QACpC,eAAe,EAAE,EAAE;QACnB,SAAS,EAAE,EAAE;KACd;IACD,WAAW,EAAE;QACX,EAAE,EAAE,EAAE;QACN,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,EAAE;KACd;IACD,QAAQ,EAAE;QACR,IAAI,EAAE,EAAE;KACT;CACF,CAAA;;ACpJD,MAAM,YAAY,GAAG,8BAA8B,CAAA;AACnD,MAAM,YAAY,GAAG,mBAAmB,CAAA;AAExC,MAAqB,IAAK,SAAQC,wBAAgB;;;;;;;;;IAuBhD,YAAa,GAAG,EAAE,MAAM;QACtB,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC,CAAA;QAvBpB,aAAQ,GAAG,MAAM,CAAA;QACjB,iBAAY,GAAG,MAAM,CAAA;QACrB,gBAAW,GAAG,GAAG,YAAY,eAAe,CAAA;QAC5C,uBAAkB,GAAG,GAAG,YAAY,wBAAwB,CAAA;QAC5D,aAAQ,GAAG;YACT,KAAK,EAAE,OAAO;YACd,KAAK,EAAE,MAAM;YACb,MAAM,EAAE,OAAO;YACf,MAAM,EAAE,KAAK;YACb,EAAE,EAAE,MAAM;SACX,CAAA;QAED,aAAQ,GAAG,IAAI,QAAQ,EAAE,CAAA;QAavB,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC;YAC/B,KAAK;gBACH,IAAI,CAAC,gBAAgB,EAAE,CAAA;gBACvB,GAAG,CAAC,qBAAqB,EAAE,CAAA;gBAC3B,IAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,YAAY,CAAC,CAAA;aACvD;SACF,CAAC,CAAA;KACH;;;;IAKD,gBAAgB;QACd,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,EAAE,UAAU,CAAC,CAAA;KACpD;CACF;;AC1CD,YAAe,CAAC,GAAmB;IACjC,GAAG,CAAC,gBAAgB,CAAC;QACnB,IAAI,EAAE,MAAM;QACZ,aAAa,EAAE,MAAM;QACrB,MAAM,EAAE,CAAE,EAAE,MAAM,EAAE;YAClB,MAAM,OAAO,GAAG,IAAI,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,CAAA;YACrC,MAAM,OAAO,CAAC,KAAK,EAAE,CAAA;SACtB;KACF,CAAC,CAAA;AACJ,CAAC,CAAA;;;;;"}